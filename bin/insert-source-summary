#!/usr/bin/env python3
# -*- coding: UTF-8 -*-

"""
Add a parsed source from stdin.

Usage:
    insert-source-summary database.sqlite3

Each line on stdin is a record of file hash, sloc, n_tokens, seperated by
whitespace.
"""

import sys
import sqlite3

conn = sqlite3.connect(sys.argv[1])
for line in sys.stdin:
    filehash, sloc, n_tokens = line.split()

    with conn:
        conn.execute('''
            INSERT OR REPLACE INTO source_summary (hash, sloc, n_tokens)
            VALUES (?, ?, ?)
        ''', (filehash, int(sloc), int(n_tokens)))
